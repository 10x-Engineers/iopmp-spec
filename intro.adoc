[[intro]]
== Introduction

This document outlines a mechanism to enhance platform security. In a platform, bus initiators can access target devices, similar to a RISC-V hart. Introducing I/O agents like DMA (Direct Memory Access Unit) improves performance, but also exposes the system to vulnerabilities such as DMA attacks. In the RISC-V ecosystem, the PMP/ePMP provides a standard protection scheme for accesses from a RISC-V hart to the physical address space. However, there is no equivalent standard for safeguarding non-CPU initiators. The Physical Memory Protection Unit for Input/Output Devices (IOPMP) addresses this by controlling accesses issued by bus initiators.

IOPMP is a hardware component within a bus fabric to address situations where pure-software solutions are insufficient. For a RISC-V-based platform, a software solution typically involves a security monitor, a program running in M-mode that handles security-related requests. When a request for a DMA transfer is made, the security monitor checks if it meets all security rules and decides if it is legal. Only legal requests are executed. However, this check can be time-consuming, especially for complex requests like those from a GPU, which may involve running a program. Determining if a program violates access rules is generally an NP-hard problem. Even just considering average execution time, the latency is often unacceptable. A hardware component that can check accesses in real-time is a more practical solution. This document focuses on IOPMP. The following figure conceptually demonstrates the integration of IOPMP into a system.


[caption="Figure {counter:image}: ", reftext="Figure {image}"]
[title="example integrations of IOPMP(s) in a system. Figure (a) shows a system deploying two IOPMPs (destination-enforcement). The IOPMPs take three inputs: RRID, the transaction type (read/write), and the request range (address/len). Figure (b) shows a system deploying two IOPMPs (source-enforcement). In this deployment, the RRID can be ignored."]
image::images/iopmp_system_position.png[]

Another hardware component in a bus matrix, the Input-Output Memory Management Unit (IOMMU), is used to translate a virtual address in a device to a physical address in the bus matrix by one or more stages of page tables. It could be operated in a trusted or untrusted environment and typically is a tool of a hypervisor or an OS. It provides excellent flexibility and reduces external memory fragmentation. However, it may not be an ideal tool for security software running in M-mode because it needs relatively large memory and relatively complicated software compared to a typical security monitor. Besides, the tables are usually stored in the DRAM, which is outside the chip and needs extra protection. For simple systems, this burden may not be affordable. IOPMP, however, consumes much less memory and stores rules inside the chip. Both of them have their own useful areas of application, so IOMMU and IOPMP could coexist and collaborate. IOPMP can be used as a tool for the secure monitor by checking access from devices controlled by other software, while IOMMU can be used by software with richer resources.

